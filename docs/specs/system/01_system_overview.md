# システム仕様書 - 要望管理システム

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | システム仕様書 |
| システム名 | 電子カルテシステム要望管理システム |
| バージョン | 1.0 |
| 作成日 | 2026-01-05 |
| 最終更新日 | 2026-01-05 |
| ステータス | 引き渡し版 |

## 目次

1. [システム概要](#1-システム概要)
2. [業務フロー](#2-業務フロー)
3. [機能一覧](#3-機能一覧)
4. [画面仕様](#4-画面仕様)
5. [データ仕様](#5-データ仕様)
6. [非機能要件](#6-非機能要件)

---

## 1. システム概要

### 1.1 システムの目的

電子カルテシステムに対する要望・フィードバックをWeb経由で受け付け、一元管理することで、要望の進捗状況を可視化し、各部門間での情報共有を円滑にすることを目的とする。

### 1.2 対象ユーザー

- **要望登録者**: 病院スタッフ全般（医師、看護師、事務職員など）
- **要望対応者**: SE部門、システム担当部門
- **管理者**: 電子カルテ委員会メンバー、システム管理者

### 1.3 システムの特徴

- Webベースでどこからでもアクセス可能
- レスポンシブデザインでPC・タブレット・スマートフォンに対応
- リアルタイムでの要望登録・進捗確認
- 複数部門・複数システムへの対応を想定した設計

### 1.4 利用環境

| 項目 | 内容 |
|------|------|
| 本番環境URL | https://felddorf.sakura.ne.jp/requestForm/ |
| 対応ブラウザ | Chrome、Firefox、Safari、Edge (最新版) |
| 対応デバイス | PC、タブレット、スマートフォン |
| 推奨画面解像度 | 1920x1080以上（PC）、960px以上（タブレット） |

---

## 2. 業務フロー

### 2.1 要望登録から完了までの流れ

```
[要望登録者]
    ↓
① 要望登録
    ↓
[システム]
    ↓
② 要望一覧に表示（ステータス: 未対応）
    ↓
[担当部門]
    ↓
③ 要望確認・対応開始（ステータス更新）
    ↓
④ 対応コメント追加
    ↓
⑤ 必要に応じて病院側へ対応依頼
    ↓
⑥ 対応完了（ステータス: 対応完了（承認前））
    ↓
[電子カルテ委員会]
    ↓
⑦ 承認（ステータス: 対応完了（電カル委員会承認））
```

### 2.2 ステータス遷移図

```
未対応
  ↓
覚知（対応検討中）
  ↓
覚知（対応中） ←→ 要追加情報
  ↓              ↓
一時対応完了    要病院対応
（要作業）        ↓
  ↓           対応保留
対応完了         ↓
（承認前）    対応不可
  ↓
対応完了
（電カル委員会承認）
```

---

## 3. 機能一覧

### 3.1 機能概要

| 機能ID | 機能名 | 概要 | 対象ユーザー |
|--------|--------|------|------------|
| F001 | 要望登録 | 新規要望を登録する | 全ユーザー |
| F002 | 要望一覧表示 | 登録済み要望を一覧表示する | 全ユーザー |
| F003 | 要望検索・フィルタリング | 条件を指定して要望を絞り込む | 全ユーザー |
| F004 | 要望詳細表示 | 要望の詳細情報とコメント履歴を表示 | 全ユーザー |
| F005 | 進捗更新 | 要望のステータスとコメントを更新 | 対応者・管理者 |
| F006 | コメント追加 | 要望に対するコメントを追加 | 対応者・管理者 |
| F007 | 要望削除 | 誤登録された要望を削除 | 管理者のみ |
| F008 | コメント削除 | 誤投稿されたコメントを削除 | 管理者のみ |

### 3.2 各機能の詳細

#### F001: 要望登録

**概要**: ユーザーが電子カルテシステムに対する要望を登録する機能

**入力項目**:
- 要望内容（必須）: テキストエリア
- 要望者所属部署（任意）: テキスト入力
- 要望者氏名（任意）: テキスト入力

**処理内容**:
1. 入力内容のバリデーション（要望内容の必須チェック）
2. UUID自動生成
3. 登録日時の自動設定（JST）
4. 初期ステータスを「未対応」に設定
5. データベースへ保存
6. 登録完了メッセージ表示
7. 要望一覧画面へ遷移

**出力**:
- 登録完了通知
- 要望一覧画面への自動遷移

---

#### F002: 要望一覧表示

**概要**: 登録されたすべての要望を一覧表示する機能

**表示項目**:
- 要望内容
- 要望者所属部署
- 要望者氏名
- 登録日時
- ステータス
- 対応企業・システム
- 担当部署
- 担当者
- 最新コメント
- 更新日時
- アクション（詳細、更新、削除）

**表示順序**:
- デフォルト: 更新日時の降順（最新が上）
- ソート可能カラム: 登録日時、更新日時、ステータス

**レイアウト**:
- **デスクトップ（1920px以上）**: テーブル表示
- **タブレット（960px〜1920px）**: カード表示
- **モバイル（960px未満）**: 簡易カード表示

**色分け**:
- **ステータス**: ステータスごとに異なる色のバッジで表示
- **対応企業・システム**:
  - 電子カルテシステム: 青
  - ネットワークシステム: 緑
  - 画像システム: オレンジ
  - その他: グレー

---

#### F003: 要望検索・フィルタリング

**概要**: 条件を指定して要望を絞り込む機能

**検索条件**:
- 要望内容: 部分一致検索
- 要望者所属部署: 部分一致検索
- 要望者氏名: 部分一致検索
- ステータス: 完全一致検索
- 登録日（開始）: 日付範囲検索
- 登録日（終了）: 日付範囲検索

**処理内容**:
1. 各検索条件の入力値を取得
2. 複数条件のAND検索を実行
3. 該当する要望のみを一覧に表示
4. 検索条件のクリア機能を提供

**出力**:
- 検索条件に合致した要望の一覧
- ヒット件数の表示

---

#### F004: 要望詳細表示

**概要**: 要望の詳細情報とコメント履歴を表示する機能

**表示内容**:
- 要望の基本情報（F002の表示項目すべて）
- コメント履歴（時系列順）
  - 対応企業・システム
  - 対応部署
  - 対応者氏名
  - ステータス
  - コメント内容
  - 最終対応内容
  - コメント日時
  - 最終対応日時

**表示形式**:
- ダイアログ（モーダル）形式で表示
- スクロール可能な形式
- コメント削除ボタン（管理者モードのみ表示）

---

#### F005: 進捗更新

**概要**: 要望のステータスとコメントを更新する機能

**入力項目**:
- ステータス（必須）: ドロップダウン選択
- 対応企業・システム（必須）: ドロップダウン選択
- 担当部署（任意）: テキスト入力
- 担当者（任意）: テキスト入力
- コメント（任意）: テキストエリア
- パスワード（必須）: パスワード入力

**パスワード認証**:
- 更新パスワード: `[操作パスワード]`
- 認証失敗時はエラーメッセージを表示し、更新を中止

**処理内容**:
1. パスワード認証
2. 入力内容のバリデーション
3. 更新日時の自動設定
4. データベースへ更新内容を保存
5. コメントが入力されている場合、Responsesテーブルへ新規レコード追加
6. 更新完了メッセージ表示
7. 一覧を再読み込み

**ステータス制限**:
- **通常モード**: 「対応完了（電カル委員会承認）」は選択不可
- **管理者モード**: すべてのステータスを選択可能

---

#### F006: コメント追加

**概要**: 要望に対する対応コメントを追加する機能

**入力項目**:
- 対応企業・システム（必須）
- 対応部署（任意）
- 対応者氏名（任意）
- ステータス（必須）
- コメント内容（任意）
- 最終対応内容（任意）

**処理内容**:
1. F005の進捗更新時に同時実行
2. Responsesテーブルへ新規レコード追加
3. UUID自動生成
4. コメント日時の自動設定

---

#### F007: 要望削除

**概要**: 誤登録された要望を削除する機能（管理者のみ）

**実行条件**:
- 管理者モードがONになっている
- 削除パスワードが正しい

**パスワード認証**:
- 削除パスワード: `[操作パスワード]`

**処理内容**:
1. 管理者モードの確認
2. 削除確認ダイアログ表示
3. パスワード認証
4. 関連するコメント（Responses）も連鎖削除
5. データベースから該当レコードを削除
6. 削除完了メッセージ表示
7. 一覧を再読み込み

**注意事項**:
- 削除は取り消し不可
- 削除前に必ず確認ダイアログを表示

---

#### F008: コメント削除

**概要**: 誤投稿されたコメントを削除する機能（管理者のみ）

**実行条件**:
- 管理者モードがONになっている
- 削除パスワードが正しい

**パスワード認証**:
- コメント削除パスワード: `[操作パスワード]`

**処理内容**:
1. 管理者モードの確認
2. 削除確認ダイアログ表示
3. パスワード認証
4. Responsesテーブルから該当レコードを削除
5. 削除完了メッセージ表示
6. コメント履歴を再読み込み

---

## 4. 画面仕様

### 4.1 画面一覧

| 画面ID | 画面名 | URL | 概要 |
|--------|--------|-----|------|
| S001 | 要望一覧画面 | `/` | 要望の一覧表示・検索・更新・削除を行う |
| S002 | 要望登録画面 | `/add-request` | 新規要望を登録する |

### 4.2 S001: 要望一覧画面

#### 画面構成

```
+--------------------------------------------------+
| [ヘッダー]                                        |
|   要望管理システム                                |
|   [一覧] [要望登録] [管理者モード: OFF/ON]        |
+--------------------------------------------------+
| [検索フィルター]                                  |
|   要望内容: [______] 部署: [______]              |
|   氏名: [______] ステータス: [▼選択]            |
|   登録日: [開始日] 〜 [終了日]                   |
|   [検索] [クリア]                                |
+--------------------------------------------------+
| [要望一覧テーブル/カード]                         |
|   要望 | 部署 | 氏名 | 日時 | ステータス | ...  |
|   ------------------------------------------------|
|   内容1 | XXX | YYY | 2026/01/01 | 未対応 | ...  |
|   内容2 | AAA | BBB | 2026/01/02 | 対応中 | ...  |
|   ...                                            |
+--------------------------------------------------+
```

#### UI要素

**ヘッダー部**:
- システムタイトル
- 一覧ボタン（現在画面を再読み込み）
- 要望登録ボタン（S002へ遷移）
- 管理者モード切替スイッチ

**検索フィルター部**:
- 要望内容入力欄
- 部署入力欄
- 氏名入力欄
- ステータス選択欄（ドロップダウン）
- 登録日（開始）日付ピッカー
- 登録日（終了）日付ピッカー
- 検索ボタン
- クリアボタン

**一覧表示部**:
- データテーブル（デスクトップ）/カード（タブレット・モバイル）
- アクションボタン
  - 詳細ボタン: コメント履歴表示
  - 更新ボタン: 進捗更新ダイアログ表示
  - 削除ボタン: 要望削除（管理者モードのみ表示）

#### ダイアログ

**詳細ダイアログ**:
- 要望の全情報を表示
- コメント履歴を時系列で表示
- 各コメントに削除ボタン（管理者モードのみ）

**更新ダイアログ**:
- ステータス選択欄
- 対応企業・システム選択欄
- 担当部署入力欄
- 担当者入力欄
- コメント入力欄
- パスワード入力欄
- 更新ボタン/キャンセルボタン

**削除確認ダイアログ**:
- 警告メッセージ
- パスワード入力欄
- 削除実行ボタン/キャンセルボタン

---

### 4.3 S002: 要望登録画面

#### 画面構成

```
+--------------------------------------------------+
| [ヘッダー]                                        |
|   要望管理システム                                |
|   [一覧] [要望登録] [管理者モード: OFF/ON]        |
+--------------------------------------------------+
| [要望登録フォーム]                                |
|                                                  |
|   要望内容 (必須):                                |
|   +--------------------------------------------+ |
|   |                                            | |
|   |                                            | |
|   |                                            | |
|   +--------------------------------------------+ |
|                                                  |
|   要望者所属部署 (任意):                          |
|   [_______________________________________]     |
|                                                  |
|   要望者氏名 (任意):                              |
|   [_______________________________________]     |
|                                                  |
|   [登録] [キャンセル]                            |
|                                                  |
+--------------------------------------------------+
```

#### UI要素

- 要望内容: 複数行テキストエリア（必須）
- 要望者所属部署: 1行テキスト入力（任意）
- 要望者氏名: 1行テキスト入力（任意）
- 登録ボタン: フォーム送信
- キャンセルボタン: S001へ遷移

#### バリデーション

- 要望内容が空の場合、登録ボタンを無効化
- 登録成功時、成功メッセージを表示してS001へ遷移
- 登録失敗時、エラーメッセージを表示

---

## 5. データ仕様

### 5.1 ステータス一覧

| ステータス値 | 表示名 | 説明 | 管理者専用 |
|------------|--------|------|-----------|
| 未対応 | 未対応 | 登録直後の初期状態 | - |
| 覚知（対応検討中） | 覚知（対応検討中） | 要望を確認し、対応を検討中 | - |
| 覚知（対応中） | 覚知（対応中） | 対応作業を実施中 | - |
| 要病院対応 | 要病院対応 | 病院側での対応が必要 | - |
| 一時対応完了（要作業） | 一時対応完了（要作業） | 一時的に対応完了したが追加作業が必要 | - |
| 対応完了（承認前） | 対応完了（承認前） | 対応完了、委員会承認待ち | - |
| 対応完了（電カル委員会承認） | 対応完了（電カル委員会承認） | 電子カルテ委員会で承認済み | ○ |
| 要追加情報 | 要追加情報 | 要望者から追加情報が必要 | - |
| 対応保留 | 対応保留 | 何らかの理由で対応を保留 | - |
| 対応不可 | 対応不可 | 対応できないと判断 | - |

### 5.2 対応企業・システム一覧

| 値 | 表示名 | 色 | 説明 |
|----|--------|----|----|
| 電子カルテシステム | 電子カルテシステム | 青 | 電子カルテ本体に関する要望 |
| ネットワークシステム | ネットワークシステム | 緑 | ネットワーク・インフラに関する要望 |
| 画像システム | 画像システム | オレンジ | 医用画像システムに関する要望 |
| その他 | その他 | グレー | 上記以外のシステム |

### 5.3 データ形式

#### 日時フォーマット

- **データベース保存**: UTC（協定世界時）
- **画面表示**: JST（日本標準時 UTC+9）
- **表示形式**: `YYYY/MM/DD HH:mm`（例: 2026/01/05 14:30）

#### UUID形式

- **形式**: UUIDv4（36文字、ハイフン含む）
- **例**: `550e8400-e29b-41d4-a716-446655440000`

---

## 6. 非機能要件

### 6.1 性能要件

| 項目 | 要件 |
|------|------|
| 応答時間 | 通常操作時3秒以内 |
| 同時アクセス | 50ユーザーまで対応 |
| データ量 | 要望10,000件まで快適に動作 |

### 6.2 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働時間 | 24時間365日 |
| 計画停止 | 月1回程度のメンテナンス時間を許容 |

### 6.3 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 通信暗号化 | HTTPS必須 |
| 認証 | パスワード認証（更新・削除時） |
| データバックアップ | 日次自動バックアップ |
| バックアップ保持期間 | 30日間 |

### 6.4 ユーザビリティ要件

| 項目 | 要件 |
|------|------|
| 対応デバイス | PC、タブレット、スマートフォン |
| レスポンシブ対応 | 必須 |
| ブラウザ対応 | Chrome、Firefox、Safari、Edge最新版 |
| 操作性 | 特別な教育なしで使用可能 |

### 6.5 保守性要件

| 項目 | 要件 |
|------|------|
| ログ保持 | バックアップログ30日間保持 |
| ドキュメント | 技術仕様書、運用マニュアル完備 |
| コード管理 | Git管理、GitHub利用 |

---

## 7. 制約事項

### 7.1 現状の制約

1. **認証システム**:
   - パスワードがソースコードにハードコーディングされている
   - ユーザー管理機能がない
   - セッション管理がない

2. **権限管理**:
   - クライアント側のモード切替のみ（サーバー側検証なし）
   - 誰でも管理者モードに切り替え可能

3. **通知機能**:
   - メール通知機能がない
   - ステータス変更時の自動通知がない

4. **データ管理**:
   - 添付ファイルアップロード機能がない
   - データのアーカイブ機能がない
   - データエクスポート機能が限定的

5. **監査ログ**:
   - 操作ログの記録がない
   - 変更履歴の追跡が限定的

### 7.2 今後の改善推奨事項

1. 認証・認可システムの実装
2. 役割ベースのアクセス制御（RBAC）導入
3. メール通知機能の追加
4. 監査ログ機能の実装
5. 添付ファイル機能の追加
6. データエクスポート機能の強化
7. API認証の強化
8. 自動テストの整備

---

## 8. 用語集

| 用語 | 説明 |
|------|------|
| 電カル | 電子カルテの略称 |
| 要望 | システムに対する改善要求やフィードバック |
| ステータス | 要望の対応状況を表す状態 |
| 覚知 | 要望を認識・把握したことを表す |
| JST | 日本標準時（Japan Standard Time、UTC+9） |
| UTC | 協定世界時（Universal Time Coordinated） |
| UUID | 汎用一意識別子（Universally Unique Identifier） |

---

## 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0 | 2026-01-05 | 初版作成（引き渡し版） | - |

---

**以上**
